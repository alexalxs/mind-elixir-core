<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Test AI Node Selection</title>
  <link rel="stylesheet" href="./dist/style.css">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }
    #map {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
    }
    .debug-info {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 12px;
      z-index: 10000;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="debug-info">
    <div>Selected Node: <span id="selectedNode">None</span></div>
    <div>Current Nodes: <span id="currentNodes">[]</span></div>
    <div>Instructions: Click a node, then click AI button (ðŸ¤–)</div>
  </div>

  <script type="module">
    import MindElixir from './dist/MindElixir.js'
    import aiAssistant from './dist/plugin/aiAssistant.js'
    
    const mind = new MindElixir({
      el: '#map',
      direction: MindElixir.LEFT,
      data: {
        nodeData: {
          id: 'root',
          topic: 'Root Node',
          root: true,
          children: [
            {
              id: 'sub1',
              topic: 'First Child',
              children: [
                { id: 'sub1-1', topic: 'Grandchild 1' },
                { id: 'sub1-2', topic: 'Grandchild 2' }
              ]
            },
            {
              id: 'sub2', 
              topic: 'Second Child',
              children: [
                { id: 'sub2-1', topic: 'Grandchild 3' },
                { id: 'sub2-2', topic: 'Grandchild 4' }
              ]
            }
          ]
        }
      },
      toolBar: true,
      keypress: true,
      contextMenu: true
    })
    
    mind.init()
    
    // Initialize AI Assistant
    aiAssistant(mind, {
      enabled: true,
      autoSuggest: false
    })
    
    // Debug info
    const selectedNodeEl = document.getElementById('selectedNode')
    const currentNodesEl = document.getElementById('currentNodes')
    
    // Listen for node selection
    mind.bus.addListener('selectNodes', (nodes) => {
      selectedNodeEl.textContent = nodes.map(n => n.topic).join(', ')
      currentNodesEl.textContent = `[${mind.currentNodes.length}] ${mind.currentNodes.map(n => n.nodeObj?.topic || '?').join(', ')}`
    })
    
    mind.bus.addListener('unselectNodes', () => {
      selectedNodeEl.textContent = mind.currentNode?.nodeObj?.topic || 'None'
      currentNodesEl.textContent = `[${mind.currentNodes.length}]`
    })
    
    // Log when AI panel opens
    mind.bus.addListener('openAIAssistant', () => {
      console.log('AI Panel opened')
      console.log('mind.currentNode:', mind.currentNode)
      console.log('mind.currentNodes:', mind.currentNodes)
      if (mind.currentNode) {
        console.log('Selected node topic:', mind.currentNode.nodeObj?.topic)
      }
    })
  </script>
</body>
</html>